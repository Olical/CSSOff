var mooSelecta=new Class({version:"1.4.0a",updated:"28/03/2011 11:20:01",Implements:[Options,Events],options:{parentNode:document,selector:"select.selecta",positionRelativeSelector:null,triggerClass:"selectaTrigger",triggerPadding:35,triggerBeforeImage:"",triggerBeforeImageWidth:0,triggerBeforeImageHeight:0,wrapperClass:"selectaWrapper",wrapperWidthAdjustment:0,wrapperShadow:"shadowy",wrapperHeight:0,optionClass:"selectaOption",optionClassSelected:"selectaOptionSelected",optionDisabledClass:"selectaDisabled",
optionClassOver:"selectaOptionOver",allowTextSelect:false,allowedKeyboardCodes:[48,49,50,51,52,53,54,55,56,57,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90],useClickListener:true},selects:{},optionList:{},focused:false,initialize:function(a){this.setOptions(a);a=this.options.parentNode.getElements(this.options.selector);if(!a.length)return false;a.each(this.replaceSelect.bind(this));this.bindListeners()},replaceSelect:function(a){if(a=document.id(a)){var b=a.getSize().x;
a.getElements("option").filter(function(a){return a.getProperty("selected")});a.retrieve("triggerElement")&&a.retrieve("triggerElement").destroy();a.retrieve("wrapper")&&a.retrieve("wrapper").destroy();a.store("triggerElement",(new Element("div",{"class":this.options.triggerClass,styles:{width:b-this.options.triggerPadding}})).inject(a,"after").addClass("cur"));b=a.retrieve("triggerElement").getSize().x-2-this.options.triggerBeforeImageWidth+this.options.wrapperWidthAdjustment;this.options.triggerBeforeImage.length&&
(new Element("div",{styles:{"float":"left",position:Browser.ie6?"absolute":"relative",background:"url("+this.options.triggerBeforeImage+") no-repeat",width:this.options.triggerBeforeImageWidth,height:this.options.triggerBeforeImageHeight}})).inject(a.retrieve("triggerElement"),"before");var c=a.getPosition(this.options.positionRelativeSelector?a.getParent(this.options.positionRelativeSelector):null);a.store("wrapper",(new Element("div",{"class":this.options.wrapperClass,styles:{width:b,zIndex:1E4,
left:c.x+1-this.options.triggerBeforeImageWidth,top:c.y+a.retrieve("triggerElement").getSize().y}})).inject(a.retrieve("triggerElement"),"after").addClass(this.options.wrapperShadow));a.set({styles:{position:"absolute",top:-1E3,left:-1E3},events:{focus:function(){this.focused&&this._hideOptions();this.focused=a;this._toggleOptions(a)}.bind(this),blur:function(){this.focused==a&&this._toggleOptions(a)}.bind(this)}});b=document.getElement("label[for="+a.get("id")+"]");a.get("id")&&b&&b.addEvent("click",
function(b){b&&b.stop&&b.stop();a.fireEvent("focus")});a.getElements("option").each(function(b){var c=false;b.get("selected")&&(a.retrieve("triggerElement").set("html",b.get("text")),c=true);this._addOption(b,a,c)},this);this.options.wrapperHeight&&a.retrieve("wrapper").getSize().y>this.options.wrapperHeight&&a.retrieve("wrapper").setStyles({height:this.options.wrapperHeight});a.retrieve("wrapper").setStyle("display","none");a.retrieve("triggerElement").addEvents({click:function(b){b&&b.stop&&b.stop();
a.fireEvent(this.focused==a?"blur":"focus")}.bind(this)});a.uid&&a&&(this.selects[a.uid]=a)}},bindListeners:function(){this.options.useClickListener&&document.addEvent("click",this._bindClickListener.bind(this));document.addEvents({keydown:function(a){var b,c,d;if(this.focused)switch(a.code){case 40:a&&a.stop&&a.stop();b=this.focused.retrieve("wrapper").getElements("div."+this.options.optionClass);d=false;b.each(function(a,c){if(!(b.length-1==c||d)&&a.hasClass(this.options.optionClassSelected))b.removeClass(this.options.optionClassOver),
b[c+1].addClass(this.options.optionClassSelected).addClass(this.options.optionClassOver),a.removeClass(this.options.optionClassSelected),d=true},this);break;case 38:a&&a.stop&&a.stop();b=this.focused.retrieve("wrapper").getElements("div."+this.options.optionClass);d=false;b.each(function(a,c){!d&&a.hasClass(this.options.optionClassSelected)&&(c>0&&(b.removeClass(this.options.optionClassOver),b[c-1].addClass(this.options.optionClassSelected).addClass(this.options.optionClassOver),a.removeClass(this.options.optionClassSelected)),
d=true)},this);break;case 13:a&&a.stop&&a.stop();this.focused.retrieve("wrapper").getElements("div."+this.options.optionClassSelected).fireEvent("click");break;case 9:this._hideOptions(this.focused);break;case 34:case 35:a&&a.stop&&a.stop();c=this.focused;this.focused.retrieve("wrapper").getElements("div."+this.options.optionClass).getLast().fireEvent("click");c.fireEvent("focus");break;case 33:case 36:a&&a.stop&&a.stop();c=this.focused;this.focused.retrieve("wrapper").getElement("div."+this.options.optionClass).fireEvent("click");
c.fireEvent("focus");break;default:if(c=this.focused,b=this.focused.retrieve("wrapper").getElements("div."+this.options.optionClass),this.options.allowedKeyboardCodes.contains(a.code)){var f=[],e=false;this.optionList["k"+this.focused.uid].filter(function(c,d){b[d].hasClass(this.options.optionClassSelected)&&(e=d);var h=c.indexOf(a.key)===0;h&&f.push(d);return h},this).length&&(f.contains(e)?b[e+1]&&f.contains(e+1)?e++:e=f[0]:e=f[0],b[e].fireEvent("click"),c.fireEvent("focus"),d=true)}else a&&a.stop&&
a.stop()}}.bind(this)})},_bindClickListener:function(a){a&&a.target&&$$(a.target).hasClass(this.options.triggerClass).contains(false)&&this._hideOptions()},_addOption:function(a,b,c){var d=a.get("text").trim();d.length||(d="&nbsp;");var f=this.optionList["k"+b.uid]||[];f.push(d.toLowerCase());var e={};e["k"+b.uid]=f;Object.append(this.optionList,e);var g=(new Element("div",{"class":this.options.optionClass,html:d,events:{mouseenter:function(){g.addClass(this.options.optionClassOver)}.bind(this),mouseleave:function(){g.removeClass(this.options.optionClassOver)}.bind(this),
click:function(a){a&&a.type&&a.stop&&a.stop();if(g.hasClass(this.options.optionDisabledClass))return false;b.retrieve("wrapper").getChildren().removeClass(this.options.optionClassSelected);g.addClass(this.options.optionClassSelected);b.retrieve("triggerElement").set("html",g.get("text"));b.set("value",g.retrieve("value")).fireEvent("change",a);this._toggleOptions(b)}.bind(this)}})).store("value",a.get("value")).inject(b.retrieve("wrapper")).addClass("cur");a.get("disabled")&&g.addClass(this.options.optionDisabledClass);
c&&g.addClass(this.options.optionClassSelected)},_toggleOptions:function(a){var b=a.retrieve("wrapper").getStyle("display");a.retrieve("wrapper").setStyle("display",b=="none"?"block":"none").getChildren().removeClass(this.options.optionClassOver);this.focused=b!="none"?false:a;var b=a.retrieve("wrapper").getPosition(this.options.overflown),c=a.retrieve("wrapper").getElement("div."+this.options.optionClassSelected).getPosition(this.options.overflown);a.retrieve("wrapper").scrollTo(c.x-b.x,c.y-b.y);
this._clearSelection()},_hideOptions:function(){Object.values(this.selects).each(function(a){a.retrieve("wrapper").getStyle("display")!="none"&&a.fireEvent("blur");a.retrieve("wrapper").setStyle("display","none");a.focused=false})},_clearSelection:function(){if(!this.options.allowTextSelect&&!Browser.ie6)if(document.selection&&document.selection.empty)try{document.selection.empty()}catch(a){}else window.getSelection&&window.getSelection().removeAllRanges()}});