var StyleSelect=new Class({Implements:[Options],options:{cloneEvents:true,cssClass:"styleme",cssActions:{c:"clicked",d:"disabled",e:"expanded",h:"hover",m:"multiple",o:"optgroup",s:"selected"},inheritCSSClass:true,skipfirst:false},initialize:function(b){try{if(b.element=document.id(b.element)||b.element,b.element===null)throw"DOM object not found";}catch(a){throw console&&console.log(a),a;}return b.element.getProperty("multiple")?new StyleSelect.Multiple(b):new StyleSelect.Simple(b)},_setup:function(){this.oCss=
this.options.cssActions;this.container=(new Element("div",{"class":this.options.cssClass,styles:{padding:Object.values(this.element.getStyles("padding")).toString(),margin:Object.values(this.element.getStyles("margin")).toString()}})).inject(this.element,"after");if(!(Browser.ie&&Browser.version<=7)){var b=this.element.getComputedSize();this.container.setStyles({height:b.height.toInt(),width:b.width.toInt()})}this.element.setStyle("display","none");this.list=(new Element("ul",{"class":"root"})).inject(this.container);
this.fnNavigate=this._navigate.bind(this);this.rebuild();this.options.inheritCSSClass&&this.container.addClass(this.element.get("class"));document.addEvent("click",function(a){this.list.removeClass(this.oCss.e);this.list.fireEvent("blur",a);document.removeEvent("keydown",this.fnNavigate)}.bind(this))},_fnAlterClass:function(b,a,c){a.removeClass(c);b.addClass(c)},_navigate:function(b){var a=this.container.getElement("li."+this.oCss.h),c=this.container.getElements("li:not(."+this.oCss.o+",."+this.oCss.d+
")"),d=null;switch(b.key){case "down":b.preventDefault();(d=c[c.indexOf(a)+1])&&!d.hasClass(this.oCss.d)&&this._fnAlterClass(d,a,this.oCss.h);break;case "up":b.preventDefault();(d=c[c.indexOf(a)-1])&&!d.hasClass(this.oCss.d)&&this._fnAlterClass(d,a,this.oCss.h);break;case "space":b.preventDefault();a.get("html")&&!a.hasClass(this.oCss.d)&&(b.control?a.addClass(this.oCss.c):this._fnAlterClass(a,c,this.oCss.c),this._setSelected());break;case "enter":a.get("html")&&!a.hasClass(this.oCss.d)&&(this._fnAlterClass(a,
c,this.oCss.c),this._setSelected(),this.list.removeClass(this.oCss.e));break;case "esc":this.container.getElement("ul").removeClass(this.oCss.e);document.removeEvent("keydown",this.fnNavigate);break;default:if(b.key.length==1){b.preventDefault();for(a=0;a<c.length;a++)if(b.code==c[a].get("html").charCodeAt(0)){this._fnAlterClass(c[a],c,this.oCss.h);break}}}},_setSelected:function(){var b=this.list.getElements("li:not(."+this.oCss.o+")");this.element.getElements("option").set("selected",false);b.each(function(a,
b){var d=null;(d=a.getElement("input[type=checkbox]"))&&d.set("checked",a.hasClass(this.oCss.c));a.hasClass(this.oCss.c)&&(this.element.getElements("option")[b].set("selected",true),this.showSelected&&(this.showSelected.set("html",a.get("html")),this.showSelected.set("data-value",a.get("data-value"))))},this)},getSelected:function(){var b=[],a=Object.filter(this.element.getElements("option"),function(a){if(typeof a=="object")return a.get("selected")});Object.each(a,function(a){b.include({option:a,
value:a.get("value"),text:a.get("text")})});return b},rebuild:function(){this._reset();var b=0;this.element.getElements("option,optgroup").each(function(a){if(a.get("tag")=="option"){if(!this.options.skipfirst||b>0){if(a.getParent()!==this.o_parent)this.o_parent=a.getParent(),this.list=this.list.getParent("ul");var c=(new Element("li",{"class":a.selected?this.oCss.s:"",html:a.get("text"),"data-value":a.get("value")})).inject(this.list);this.options.checkboxes&&(c.set("html",""),c.adopt((new Element("label",
{html:a.get("text"),events:{click:function(a){a.preventDefault()}}})).grab(new Element("input",{type:"checkbox"}),"top")));a.hasAttribute("disabled")&&c.addClass(this.oCss.d)}b++}else this.o_parent=a,c=(new Element("li",{"class":a.get("tag"),"data-value":""})).inject(this.list),this.list=(new Element("ul",{"class":"ul-"+a.get("tag")})).inject(c),a.get("label")&&(new Element("span",{html:a.get("label"),events:{click:function(a){a.stop()}}})).inject(c,"top")},this);this._addCustomEvents();this.options.cloneEvents&&
(this.container.cloneEvents(this.element),this.container.removeEvents("change"),this.container.getElements("li:not(."+this.oCss.o+",."+this.oCss.d+")").addEvent("click",function(a){this.element.fireEvent("change",a)}.bind(this)))}});
StyleSelect.Simple=new Class({Extends:StyleSelect,initialize:function(b){this.setOptions(b);this.element=this.o_parent=this.options.element;this._setup();this.container.addEvent("click",function(a){a.stop();var a=this.list,b=$$("select[style] + div."+this.options.cssClass+" > ul.root");a.hasClass(this.oCss.e)?(b.removeClass(this.oCss.e),document.removeEvent("keydown",this.fnNavigate)):(this._fnAlterClass(a.getElement("li."+this.oCss.c)||a.getElement("li:first-child"),a.getElements("li"),this.oCss.h),
this._fnAlterClass(a,b,this.oCss.e),document.addEvent("keydown",this.fnNavigate))}.bind(this))},_reset:function(){this.list.set("html","");var b=null;(b=this.list.getNext("a"))&&b.dispose();b=this.element.getSelected()[0]||new Element("option",{text:"","data-value":""});this.showSelected=(new Element("a",{href:"",events:{click:function(a){a.preventDefault()},mousedown:function(a){a.preventDefault()}},html:b.get("text"),"data-value":b.get("data-value")})).inject(this.container)},_addCustomEvents:function(){this.list.addEvent("click",
function(a){a.stopPropagation();a.preventDefault();this.list.toggleClass(this.oCss.e)}.bind(this));var b=this.list.getElements("li");b.each(function(a){a.addEvents({mouseover:function(a){a.target.hasClass(this.oCss.d)||this._fnAlterClass(a.target,b,this.oCss.h)}.bind(this),click:function(a){a.target.hasClass(this.oCss.d)||(this._fnAlterClass(a.target,b,this.oCss.c),this._setSelected())}.bind(this)})},this)}});
StyleSelect.Multiple=new Class({Extends:StyleSelect,options:{size:4,checkboxes:false},initialize:function(b){this.setOptions(b);this.element=this.o_parent=this.options.element;this._setup();this.container.addClass(this.oCss.m);b=this.options.size||this.element.getProperty("size");this.container.setStyle("height",this.list.getElement("li:first-child").getSize().y*b);this.list.getElements("li").each(function(a){a.hasClass(this.oCss.s)&&a.addClass(this.oCss.c)},this)},_reset:function(){this.list.set("html",
"")},_addCustomEvents:function(){this.list.addEvents({click:function(a){a.stopPropagation()},focus:function(){var a=this.list;$$("select[style] + div."+this.options.cssClass+" > ul.root").removeClass(this.oCss.e);this._fnAlterClass(a.getElement("li."+this.oCss.c)||a.getElement("li:first-child"),a.getElements("li"),this.oCss.h);document.addEvent("keydown",this.fnNavigate)}.bind(this),blur:function(){this.list.getElements("li").removeClass(this.oCss.h);document.removeEvent("keydown",this.fnNavigate)}.bind(this)});
var b=this.list.getElements("li:not(.optgroup)");b.each(function(a){a.addEvents({click:function(c){var d=c.target==a?c.target:a;d.hasClass(this.oCss.d)||(c.control?d.addClass(this.oCss.c):this._fnAlterClass(d,b,this.oCss.c),this._setSelected(),this.list.fireEvent("focus",c))}.bind(this)})},this)}});